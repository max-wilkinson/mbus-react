(this["webpackJsonpmbus-react"]=this["webpackJsonpmbus-react"]||[]).push([[0],{19:function(e,t,n){e.exports=n.p+"static/media/accentBars.50ec595e.svg"},30:function(e,t,n){e.exports=n(44)},35:function(e,t,n){},37:function(e,t,n){},41:function(e,t,n){},42:function(e,t,n){},44:function(e,t,n){"use strict";n.r(t);var a=n(3),r=n.n(a),c=n(23),o=n.n(c),i=(n(35),n(10)),u=n.n(i),s=n(13),l=n(18),m=n(15),v=n(12),f=n(11),d=n(24),p=n(25),b=function(){function e(){Object(d.a)(this,e)}return Object(p.a)(e,[{key:"determineNearbyStops",value:function(){var e=Object(s.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getUserLocation();case 2:return n=e.sent,e.abrupt("return",this.sortStopsByDistance(n,t));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUserLocation",value:function(){var e=Object(s.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPosition();case 2:return t=e.sent,e.abrupt("return",t.coords);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getPosition",value:function(){var e={enableHighAccuracy:!0,timeout:7e3};return new Promise((function(t,n){navigator.geolocation.getCurrentPosition(t,n,e)}))}},{key:"sortStopsByDistance",value:function(e,t){var n=!0,a=!1,r=void 0;try{for(var c,o=t[Symbol.iterator]();!(n=(c=o.next()).done);n=!0){var i=c.value;i.distance=this.calculateDistance(i,e)}}catch(u){a=!0,r=u}finally{try{n||null==o.return||o.return()}finally{if(a)throw r}}return t.sort((function(e,t){return void 0===e.distance||void 0===t.distance?0:e.distance-t.distance})),t}},{key:"calculateDistance",value:function(e,t){var n=t.latitude,a=t.longitude;return Math.sqrt(Math.pow(e.lat-n,2)+Math.pow(e.lon-a,2))}}]),e}(),h=function(e){return r.a.createElement("div",null,r.a.createElement("h3",{className:"routeName"},function(e,t){var n=!0,a=!1,r=void 0;try{for(var c,o=t[Symbol.iterator]();!(n=(c=o.next()).done);n=!0){var i=c.value;if(i.id===e)return i.name}}catch(u){a=!0,r=u}finally{try{n||null==o.return||o.return()}finally{if(a)throw r}}return"Unknown Route"}(e.routeId,e.routes)),Object.values(e.etasByRoute[e.routeId]).map((function(e,t){return r.a.createElement("h4",{className:"routeStatus",key:t},e," minutes until next bus")})))};n(37);function y(){var e=Object(m.a)(["\n  query getEtas($stop: Int) {\n    etas(stop: $stop) {\n      route\n      avg\n      bus_id\n    }\n    routes {\n      id\n      name\n    }\n  }\n"]);return y=function(){return e},e}var E=Object(f.b)(y()),w=function(e){var t=Object(a.useState)({}),n=Object(l.a)(t,2),c=n[0],o=n[1],i=Object(v.a)(E,{variables:{stop:Number(e.stop.id)}}),u=i.loading,s=i.error,m=i.data;return Object(a.useEffect)((function(){if(void 0!==m){var e={},t=!0,n=!1,a=void 0;try{for(var r,c=m.etas[Symbol.iterator]();!(t=(r=c.next()).done);t=!0){var i=r.value;i.route in e?e[i.route].push(i.avg):e[i.route]=[i.avg]}}catch(u){n=!0,a=u}finally{try{t||null==c.return||c.return()}finally{if(n)throw a}}o(e)}}),[e.stop,m]),u?r.a.createElement("div",null):s?r.a.createElement("div",null):r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"accentLine"}),r.a.createElement("h2",{className:"busStopText"},e.stop.name),Object.keys(c).map((function(e,t){return r.a.createElement("div",{className:"routeDetails",key:t},r.a.createElement(h,{routeId:e,routes:m.routes,etasByRoute:c}))})))};n(41);function g(){var e=Object(m.a)(["\n  {\n    activeStops {\n      id\n      name\n      lat\n      lon\n    }\n  }\n"]);return g=function(){return e},e}var j=Object(f.b)(g()),O=function(){var e=Object(a.useState)([]),t=Object(l.a)(e,2),n=t[0],c=t[1],o=Object(v.a)(j),i=o.loading,m=o.error,f=o.data,d=new b;return Object(a.useEffect)((function(){function e(){return(e=Object(s.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=c,e.next=3,d.determineNearbyStops(f.activeStops);case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}void 0!==f&&function(){e.apply(this,arguments)}()})),i?r.a.createElement("div",null):m?r.a.createElement("div",null):r.a.createElement("div",null,n.slice(0,5).map((function(e,t){return r.a.createElement("div",{className:"card",key:t},r.a.createElement(w,{stop:e}))})))},k=n(7),N=n(19),x=n.n(N),S=(n(42),new f.a({uri:"https://mbusql.azurewebsites.net/graphql"})),B=function(){return r.a.createElement(k.a,{client:S},r.a.createElement("div",{className:"app"},r.a.createElement("img",{src:x.a,className:"accentBars topBars",alt:""}),r.a.createElement("header",null,r.a.createElement("h1",{className:"title"},"MBus")),r.a.createElement("div",{className:"cardList"},r.a.createElement(O,null)),r.a.createElement("img",{src:x.a,className:"accentBars bottomBars",alt:""})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(B,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[30,1,2]]]);
//# sourceMappingURL=main.e9d807c6.chunk.js.map